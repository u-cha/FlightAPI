# Проект “Поиск авиарейсов”
REST API для описания аэропортов и рейсов между ними, совершаемых авиакомпаниями. Позволяет просматривать и редактировать списки аэропортов, авиакомпаний и рейсов, совершать планирование маршрута перелета с учетом заданного количества пересадок.

Веб-интерфейс для проекта не подразумевается.

## Таблица Airports

**id** - айди аэропорта, автоинкремент, первичный ключ

**code (varchar)** - IATA-код аэропорта

**name (varchar)** - название аэропорта

*Справочно*: IATA-коды аэропортов представляют собой уникальные сочетания из трех букв латинского алфавита.

Коды аэропортов мира -  

*Индексы*:

Первичный ключ по полю ID;

Unique индекс по полю Code для гарантии уникальности аэропорта в таблице, и для ускорения поиска аэропорта по его коду.

## Таблица Airlines

**id** - айди авиалинии, автоинкремент, первичный ключ

**code (varchar)** - IATA-код авиалинии

**name (varchar)** - название авиалинии

*Справочно*: IATA-коды авиакомпаний представляют собой уникальные сочетания из двух символов - букв латинского алфавита и цифр.

Примеры кодов авиакомпаний - https://www.nationsonline.org/oneworld/Airlines/airlines_africa.htm

*Индексы*:

Первичный ключ по полю ID;

Unique индекс по полю Code для гарантии уникальности авиакомпании в таблице, и для ускорения поиска авиакомпании по ее коду.

## Таблица Flights

**id** - айди маршрута, автоинкремент, первичный ключ

**from_airport_id (int)** - id аэропорта отправления, внешний ключ на Airports.id

**to_airport_id (int)** - id аэропорта назначения, внешний ключ на Airports.id

**airline_id (int)** - id авиакомпании, внешний ключ на Airlines.id

**price (decimal, 2)** - цена перелета, с 2 знаками после запятой

*Индексы*

Первичный ключ по полю ID;

Индекс по паре полей from_airport_id, to_airport_id для ускорения поиска машрута по аэропортам отправления и назначения.

Unique Индекс по набору полей from_airport_id, to_airport_id, airline для обеспечения уникальности маршрута в рамках конкретной авиакомпании.


# REST API
Методы REST API реализуют CRUD интерфейс над базой данных - позволяют создавать (C - create), читать (R - read), редактировать (U - update). В целях упрощения, опустим удаление (D - delete).


## Аэропорты
### GET /airports
Получение списка аэропортов

*Пример ответа*:

`[
    {
        "id":0,
        "code":"AUH",
        "name":"Abu Dhabi International"
    },
    {
        "id":1,
        "code":"AZB",
        "name":"Amazon Bay"
    }
]`



**HTTP коды ответов**:

Успех - 200

Ошибка (например, база данных недоступна) - 500

### GET /airports/AUH
Получение конкретного аэропорта. 

*Пример ответа*:

`{
    "id":0,
    "code":"AUH",
    "name":"Abu Dhabi International"
}`


**HTTP коды ответов**:

Успех - 200

Код аэропорта отсутствует в адресе - 400

Аэропорт не найден - 404

Ошибка (например, база данных недоступна) - 500


### POST /airports
Добавление нового аэропорта в базу. Данные передаются в теле запроса в виде полей формы (x-www-form-urlencoded). Поля формы - code, name. Пример ответа - JSON представление вставленной в базу записи, включая её ID:

`{
    "id": 0,
    "code": "AUH",
    "name": "Abu Dhabi International"
}`

**HTTP коды ответов**:

Успех - 200

Отсутствует нужное поле формы - 400

Аэропорт с таким кодом уже существует - 409

Ошибка (например, база данных недоступна) - 500


## Авиалинии


### GET /airlines

Получение списка авиакомпаний

*Пример ответа*:

`[
    {"id": 0,
    "code": "SU",
    "name": "Aeroflot"
    },
    {"id": 1,
    "code": "S7",
    "name": "Siberian Airlines"
    }
]`


**HTTP коды ответов**:

Успех - 200

Ошибка (например, база данных недоступна) - 500

### GET /airlines/SU

Получение конкретной авиакомпании. 

*Пример ответа*:

`{
    "id": 0,
    "code": "SU",
    "name": "Aeroflot"
}`


**HTTP коды ответов**:

Успех - 200

Код авиакомпании отсутствует в адресе - 400

Авиакомпания не найдена - 404

Ошибка (например, база данных недоступна) - 500

### POST /airlines

Добавление новой авиакомпании в базу. Данные передаются в теле запроса в виде полей формы (x-www-form-urlencoded). Поля формы - code, name. Пример ответа - JSON представление вставленной в базу записи, включая её ID:

`{
    "id": 0,
    "code": "SU",
    "name": "Aeroflot"
}`

**HTTP коды ответов**:

Успех - 200

Отсутствует нужное поле формы - 400

Авиакомпания с таким кодом уже существует - 409

Ошибка (например, база данных недоступна) - 500

## Перелеты

### GET /flights
Получение списка доступных рейсов. Пример ответа:

`[
    {
        "id":0,
        "from_airport":{
            "id":0,
            "code":"AUH",
            "name":"Abu Dhabi International"
        },
        "to_airport":{
            "id":1,
            "code":"AZB",
            "name":"Amazon Bay"
        },
        "airline":{
            "id":0,
            "code":"SU",
            "name":"Aeroflot"
        },
        "price":1899
    }
]`

**HTTP коды ответов**:

Успех - 200

Ошибка (например, база данных недоступна) - 500



### POST /flights
Добавление нового рейса в базу. Данные передаются в теле запроса в виде полей формы (x-www-form-urlencoded). Поля формы - from_airport_code, to_airport_code, airline, price. 

Пример полей формы:

**from_airport_code** - AUH

**to_airport_code** - AZB

**airline** - SU

**price** - 1699


Пример ответа - JSON представление вставленной в базу записи, включая её ID:

`{
    "id": 0,
    "from_airport": {
        "id": 0, 
        "code": "AUH",
        "name": "Abu Dhabi International"
        },
    "to_airport": {
        "id": 1, 
        "code": "AZB", 
        "name": "Amazon Bay"
        }, 
    "airline": {
        "id": 0, 
        "code": "SU",
        "name": "Aeroflot"
        },
    "price": 1899
}`


**HTTP коды ответов**:

Успех - 200

Отсутствует нужное поле формы - 400

Маршрут авиакомпании с такими аэропортами отправления и назначения уже существует - 409

Ошибка (например, база данных недоступна) - 500

### PATCH /flights/AUHAZBSU
Обновление существующего в базе маршрута. Маршрут задаётся идущими подряд кодами аэропортов и авиакомпании. Данные передаются в теле запроса в виде полей формы (x-www-form-urlencoded). Единственное поле формы - price.

Пример ответа - JSON представление обновлённой записи в базе данных, включая её ID:

`{
    "id": 0, 
    "from_airport": {
        "id": 0, 
        "code": "AUH",
        "name": "Abu Dhabi International"
        },
    "to_airport": {
        "id": 1,
        "code": "AZB",
        "name": "Amazon Bay"
        },
    "airline": 
        {"id": 0,
        "code": "SU",
        "name": "Aeroflot"},
    "price": 1899
}`


**HTTP коды ответов**:

Успех - 200

Отсутствует нужное поле формы - 400

Такого маршрута нет в базе данных - 409

Ошибка (например, база данных недоступна) - 500


## Поиск маршрута 
### GET /routes/AUH/AZB?max_stops=2
Поиск маршрута из аэропорта отправления в аэропорт назначения с указанием максимального количества пересадок.

Ответом является массив объектов JSON, содержащий список доступных маршрутов, удовлетворяющих заданным параметрам.

Пример ответа:


`
[
{
    "total_price":11899,
    "num_stops": 1, 
    "flights":[
        {
            "id":3,
            "from_airport":{
                "id":0,
                "code":"AUH",
                "name":"Abu Dhabi International"
            },
            "to_airport":{
                "id":2,
                "code":"NYC",
                "name":"New York City"
            },
            "airline":{
                "id":0,
                "code":"SU",
                "name":"Aeroflot"
            },
            "price":1899
        },
        {
            "id":3,
            "from_airport":{
                "id":2,
                "code":"NYC",
                "name":"New York City"
            },
            "to_airport":{
                "id":1,
                "code":"AZB",
                "name":"Amazon Bay"
            },
            "airline":{
                "id":1,
                "code":"S7",
                "name":"Siberian Airlines"
            },
            "price":10000
        }
    ]
}
]`

Если нашлось несколько маршрутов, они будут лежать отдельными объектами в массиве верхнего уровня, у каждого будут свои полеты и свой total_price


Поиск маршрута осуществляется следующим образом.

1. Если количество пересадок не указано, то считается, что указано максимальное число пересадок - 2. Если количество пересадок указано (в диапазоне 0-2), то поиск исходит из него.


2. Проверяются все доступные маршруты, удовлетворяющие условиям поиска.
- при 0 пересадок осуществляется поиск только прямых рейсов между точкой отправления и назначения
- при 1 (2) пересадках производится поиск всех возможных вариантов добраться из точки отправления в точку назначения с не более, чем 1 (2) пересадками, ответом является список таких вариантов.



